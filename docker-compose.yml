# ============================================
# DOCKER COMPOSE - TEAHAVEN
# ============================================
# Docker Compose lets us define and run multiple containers
# with a single command: docker-compose up
#
# What is Docker?
# - Think of it as a lightweight virtual machine
# - Each "container" is an isolated environment
# - We use it to run MySQL without installing it on your computer

version: '3.8'

services:
  # ----------------------------------------
  # MySQL Database Service
  # ----------------------------------------
  # This creates a MySQL container that our backend connects to
  
  mysql:
    # Use the official MySQL 8.0 image from Docker Hub
    image: mysql:8.0
    
    # Name the container so we can reference it easily
    container_name: teahaven-mysql
    
    # Restart automatically if it crashes
    restart: unless-stopped
    
    # Environment variables configure MySQL on first run
    environment:
      # Root password (for admin access)
      MYSQL_ROOT_PASSWORD: teahaven123
      
      # Create a database automatically
      MYSQL_DATABASE: teahaven
      
      # Optional: Create a regular user (more secure for production)
      # MYSQL_USER: teahaven_user
      # MYSQL_PASSWORD: teahaven_user_pass
    
    # Port mapping: HOST_PORT:CONTAINER_PORT
    # This lets us access MySQL from localhost:3306
    ports:
      - "3306:3306"
    
    # Volumes persist data even when container stops
    # Without this, you'd lose all data on restart!
    volumes:
      # Named volume for database files
      - teahaven_mysql_data:/var/lib/mysql
      
      # Mount init scripts (runs on first startup)
      - ./database/init:/docker-entrypoint-initdb.d
    
    # Health check - Docker verifies MySQL is actually ready
    healthcheck:
      test: ["CMD", "mysqladmin", "ping", "-h", "localhost"]
      timeout: 20s
      retries: 10

# ----------------------------------------
# Volumes
# ----------------------------------------
# Named volumes persist data outside containers

volumes:
  teahaven_mysql_data:
    # This volume stores all MySQL data
    # Even if you delete the container, data remains
